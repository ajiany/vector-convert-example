<!DOCTYPE html>
<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/canvg/3.0.9/umd.js" integrity="sha512-Wu9XXg78PiNE0DI4Z80lFKlEpLq7yGjquc0I35Nz+sYmSs4/oNHaSW8ACStXBoXciqwTLnSINqToeWP3iNDGmQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdn.jsdelivr.net/npm/pdfkit@0.13.0/js/pdfkit.standalone.js" integrity="sha256-41qk5dewLKulpzhP3H6G7mY+5q+vzxMaxolsOGmZD/8=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/blob-stream-browserify@0.1.3/index.js" integrity="sha256-bFrIR3MiIsKhM2EDZdTJ3eY7iSluq1W7e6dNVwScEYw=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/svg-to-pdfkit@0.1.8/source.js" integrity="sha256-NaOoypZxJFnz2e4IeMtA9+UMZ5Fh85ljICcUts98jqY=" crossorigin="anonymous"></script>
        <script src="svg-export.min.js"></script>
    </head>
    <body>
        <div>
            <h1>Image Upload and Convert</h1>
            <div>
                <input type="file" id="imageUpload" accept="image/*">
                <button id="btn_upload">Upload Image</button>
            </div>
            <div>
                <svg id="mysvg" height="400" width="100%"></svg>
            </div>
        </div>
        <div>
            <button id="btn_export_svg">SVG</button>
            <button id="btn_export_jpeg">JPEG</button>
            <button id="btn_export_png">PNG</button>
            <button id="btn_export_pdf">PDF</button>
        </div>
    </body>
    <script>
        let uploadedImageSvg = null;

        document.querySelector("#btn_export_svg").onclick = function(){
            if (uploadedImageSvg) {
                svgExport.downloadSvg(uploadedImageSvg, "Uploaded image");
            } else {
                alert("Please upload an image first.");
            }
        };

        document.querySelector("#btn_export_jpeg").onclick = function(){
            if (uploadedImageSvg) {
                svgExport.downloadJpeg(uploadedImageSvg, "Uploaded image");
            } else {
                alert("Please upload an image first.");
            }
        };

        document.querySelector("#btn_export_png").onclick = function(){
            if (uploadedImageSvg) {
                svgExport.downloadPng(uploadedImageSvg, "Uploaded image");
            } else {
                alert("Please upload an image first.");
            }
        };

        document.querySelector("#btn_export_pdf").onclick = function(){
            if (uploadedImageSvg) {
                svgExport.downloadPdf(uploadedImageSvg, "Uploaded image");
            } else {
                alert("Please upload an image first.");
            }
        };

        document.querySelector("#btn_upload").onclick = function(){
            const fileInput = document.querySelector("#imageUpload");
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                        svg.setAttribute("width", img.width);
                        svg.setAttribute("height", img.height);
                        
                        const image = document.createElementNS("http://www.w3.org/2000/svg", "image");
                        image.setAttribute("href", e.target.result);
                        image.setAttribute("width", "100%");
                        image.setAttribute("height", "100%");
                        
                        svg.appendChild(image);
                        uploadedImageSvg = svg;

                        // Update the preview
                        const previewSvg = document.querySelector("#mysvg");
                        previewSvg.innerHTML = '';
                        previewSvg.appendChild(image.cloneNode(true));
                    }
                    img.src = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        };
    </script>
</html>
